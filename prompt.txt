Tarea 5 — Servicio de Chat (historial + streaming por WS)
Contexto
El panel conversacional envía mensajes de usuario y recibe respuestas del agente/CLI. Necesitamos historial y eventos WS.

Objetivo
Implementar ChatService que persista chat_messages (SQLite) y publique eventos type=chat por WS al ir llegando salida del CLI (stream line‑by‑line si aplica).

Entregables

app/services/chat.py con API para send_user_message(project_id, text).
app/routers/chat.py: POST /api/v1/chat/send?projectId=....
Publicación a /ws/events con Envelope (role, content, msgId).
Restricciones y consideraciones

Tamaño máximo de mensaje (config). Sanitización básica.
Asociar user/agent/system como roles.
Criterios de aceptación (DoD)

Enviar texto produce evento chat visible por WS.
Historial recuperable por proyecto (endpoint extra opcional).
Buenas prácticas y notas para el agente

Usar colas asyncio para no bloquear loop.
Manejo robusto de errores (respuesta 4xx con detalle).